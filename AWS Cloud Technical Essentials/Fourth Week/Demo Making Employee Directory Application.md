![[index.mp4]]
Olá a todos, sejam bem-vindos ao nosso passo a passo do exercício final , no qual lidamos com o balanceamento de carga e o dimensionamento automático do nosso aplicativo. Como os senhores podem ver, já estou conectado ao AWS Management Console e estou usando o usuário Admin que criei anteriormente para lidar com essas tarefas. Portanto, para configurar o balanceamento de carga e o Auto Scaling, a primeira coisa que vou fazer é iniciar a instância do aplicativo. Portanto, vou acessar o EC2, e, em seguida, acessar minhas instâncias e trabalhar com a última instância que criei. Nesse caso, é employee-directory-app-dynamodb. Então, selecionarei essa instância e irei em frente e usarei o atalho que temos usado, onde clico em Actions, Image and templates, e, em seguida, Launch more like this. Nesse caso, em vez de anexar dynamodb, vou anexar lb para balanceamento de carga para essa instância, e, em seguida, vou rolar e certificar-me de que tudo está onde eu quero que esteja. Portanto, quero ter certeza de que continua usando o mesmo par de chaves, e também quero ter certeza de que habilita o IP público, para que eu possa acessar e testar essa instância. A partir daí, vou rolar a tela para baixo até os detalhes avançados. Novamente, apenas para verificar novamente se a função da instância ainda está selecionada e se os dados do usuário estão onde os deixei. E, a partir daí, vou em frente e clico em Launch Instance. Agora que a instância está sendo iniciada, posso ir até View my instances (Exibir minhas instâncias), e darei a ela algum tempo para que seja totalmente iniciada, para que possamos ter certeza de que a instância está funcionando e que o aplicativo está pronto para ser usado. Muito bem, agora que já se passaram alguns minutos, vou seguir em frente e clicar em atualizar novamente. E parece que duas das duas verificações foram aprovadas para essa instância do aplicativo. Então, apenas para verificar se o aplicativo está em funcionamento, vou copiar o IPV do endereço IP e colá-lo em uma nova guia. E parece que nosso Employee Directory está em funcionamento. E como ele tem acesso ao bucket S3 e à tabela DynamoDB que foram criados, os dados que eu já havia adicionado ao diretório ainda estarão visíveis mesmo que essa seja uma nova instância. Então, agora que verifiquei que isso funciona, posso ir em frente e fechar isso. E o que quero fazer a seguir é criar o balanceador de carga do aplicativo. Então, para fazer isso, preciso estar no Console do EC2 porque os balanceadores de carga são acessados por meio do Console do EC2. Portanto, a maneira de acessar o balanceamento de carga é: Role para baixo nesse painel de navegação lateral, e, em seguida, há essa seção perto da parte inferior que diz Load Balancing. O que quero fazer é clicar em Load Balancers. E agora que estou na página Load Balancers, vou seguir em frente e clicar em Create load balancer. E o tipo de load balancer que quero aqui é um Application Load Balancer. Portanto, nessa opção, vou seguir em frente e clicar em Create. Para o nome do meu balanceador de carga, quero ir em frente e colocar app-elb, e, em seguida, quero ter certeza de que esse é um balanceador de carga voltado para a Internet, para que eu possa acessar seu endpoint a partir da Internet. Depois disso, vou rolar para baixo. E, em Network mapping (Mapeamento de rede), preciso me certificar de selecionar meu app-vpc porque é lá que minhas instâncias são lançadas, é lá que minhas instâncias para esse aplicativo serão lançadas. E, em seguida, para os mapeamentos de Availability Zone (Zona de disponibilidade), quero selecionar us-west-2a e us-west-2b. Uma vez selecionadas, o senhor pode ver que aparece a possibilidade de especificar quais sub-redes quero rotear, e vou seguir em frente e manter isso com as sub-redes públicas para essas zonas de disponibilidade. Então, rolando para baixo, chego aos grupos de segurança. E o que quero fazer aqui é garantir que o acesso adequado esteja configurado para o meu balanceador de carga. Para fazer isso, em vez de usar esse grupo de segurança padrão, vou seguir em frente e clicar em Create new security group (Criar novo grupo de segurança), e isso me levará a uma página onde posso fazer exatamente isso. Posso criar um novo grupo de segurança. Portanto, para esse, vou nomeá-lo load-balancer-sg e minha descrição é apenas... Isso é para acesso HTTP. O VPC para esse precisa ser meu app-vpc, portanto, certifique-se de que seja o selecionado. E então quero trabalhar com minhas regras. No momento, não há regras de entrada, portanto, vou adicionar uma regra, e, em seguida, adicionar acesso HTTP de qualquer lugar. E, a partir daí, vou seguir em frente e criar meu grupo de segurança. Agora que o grupo de segurança foi criado, posso fechar a nova guia e atualizar minha lista de grupos de segurança. E agora posso selecionar o grupo de segurança que acabei de criar, e esse será o grupo de segurança que usarei para esse balanceador de carga. Agora que isso foi feito, ou rolar para baixo até Listeners and routing, e é aqui que determino como meu balanceador de carga está recebendo solicitações e como está encaminhando essas solicitações. Então, aqui vou clicar em Create target group, e isso abrirá uma nova guia. Quero manter Instâncias selecionadas como o tipo de destino, e, em seguida, quero nomear meu grupo de destino, app-target-group. Depois disso, quero ter certeza de que ele está associado à VPC correta. E, em seguida, quero rolar para baixo até Health checks. As verificações de integridade serão a forma como o balanceador de carga determina quais instâncias são capazes ou quais alvos são capazes de receber solicitações. Aqui, quero expandir as configurações avançadas de verificação de integridade, e quero definir meu limite de integridade como dois, e meu limite de não integridade como cinco. Também quero definir meu Timeout como 30 segundos, e quero alterar o intervalo das verificações para 40 segundos. Então, o que isso faz é: o limite saudável é quantas verificações de saúde consecutivas bem-sucedidas determinarão se a instância ou o destino está disponível para receber solicitações. Um limite não saudável é quantas verificações de integridade consecutivas com falha determinam quais alvos não estão disponíveis para receber solicitações. Para o Timeout, é apenas quanto tempo levará para a verificação de integridade falhar se nenhuma resposta for recebida. E o Intervalo é a frequência com que as verificações de integridade serão enviadas. Com todos esses itens selecionados, vou prosseguir e rolar para baixo, e clicar em Next (Próximo). E agora posso registrar os alvos no meu grupo-alvo que estou criando. Para isso, vou acessar e selecionar a instância que acabei de lançar para incluir como alvo, e, em seguida, selecionar Incluir como pendente abaixo. Agora que ela foi incluída, o que vai acontecer é que criarei o grupo de destino e, em seguida, o balanceador de carga iniciará as verificações de integridade para garantir que essa instância como destino esteja funcionando. Então, vou em frente e clico em Create target group (Criar grupo de destino), e o grupo de destino foi criado. Portanto, como o grupo de destino foi criado, vou em frente e fecho essa guia. E, de volta à minha página de criação do balanceador de carga, posso ir em frente e atualizar meus ouvintes na lista suspensa de roteamento, e posso selecionar o app-target-group que acabei de criar para ser utilizado pelo balanceador de carga. Depois de selecionar isso, posso rolar para baixo e clicar em Create load balancer. E agora que o balanceador de carga está sendo criado, posso clicar em View load balancer. E, como os senhores podem ver agora, tenho um balanceador de carga que foi criado recentemente e está sendo provisionado, e isso levará apenas alguns minutos. Portanto, após alguns minutos, podemos ver que o estado do balanceador de carga mudou para Active (Ativo). Portanto, o que quero fazer a partir daqui é testar para ter certeza de que posso acessar meu aplicativo a partir do balanceador de carga. Para fazer isso, selecionarei esse balanceador de carga específico. E o que quero fazer é copiar o nome DNS para esse balanceador de carga. Com isso copiado, vou em frente e abrirei uma nova guia, colarei esse endpoint do balanceador de carga lá. E, como podemos ver, o balanceador de carga está direcionando o tráfego para a instância do aplicativo com os dados que adicionei. Muito bem, agora que posso ver que isso funciona, vou voltar para o EC2 Management Console. E a próxima coisa que quero fazer é preparar tudo para o escalonamento. Portanto, a primeira coisa que preciso fazer para fazer isso é criar um modelo de lançamento. Portanto, no menu à esquerda, em Instances, há uma seleção para Launch Templates. Vou selecionar essa opção. E, como no momento não tenho nenhum modelo de inicialização criado, vou clicar em Create launch template. Meu nome para esse será app-launch-template e minha descrição será apenas Um servidor da Web para o aplicativo de diretório de funcionários. A partir daí, para orientação do Auto Scaling, quero selecionar este porque vou me concentrar especificamente no Auto Scaling do EC2, e, em seguida, quero rolar para baixo e selecionar os componentes necessários para que eu inicie minhas instâncias. O que o modelo de lançamento faz é apenas informar ao Auto Scaling o que quero lançar. Então, quais instâncias, como configurar essas instâncias e todos os detalhes que o senhor usaria se estivesse lançando instâncias manualmente. Então, o que posso fazer aqui é, já que tenho instâncias em execução, posso selecionar Currently in use, e isso exibirá o que estou executando no momento. E como minha conta só tem uma instância em execução no momento, ele extrairá as informações dessa instância. Para o tipo de instância, quero selecionar t2 micro, porque esse é o tipo de instância que quero escalonar, e é elegível para a camada Free, o que manterá os custos baixos para esse pequeno exercício. Para minha chave, continuarei selecionando as mesmas chaves que tenho selecionado. E, em seguida, para minhas configurações de rede, quero me certificar de selecionar o grupo de segurança que criei especificamente para isso. E, portanto, esse será meu grupo de segurança da Web. Depois de fazer isso, vou seguir em frente e rolar para baixo até meus detalhes avançados e expandi-los. E as duas principais coisas que quero fazer aqui são: quero ter certeza de que meu perfil de instância está utilizando a função que configurei para acessar os outros recursos, e depois quero ter certeza de que adiciono meus dados de usuário para instalar e configurar o aplicativo que estou usando. Então, para fazer isso, vou seguir em frente e colar os dados do usuário aqui, mas depois preciso, só preciso ter certeza de que alterei os componentes necessários para que eu esteja trabalhando com os mesmos recursos. Portanto, mudarei meu bucket para o bucket que criei para esse aplicativo, e mudarei minha região para us-west-2 para a região do Oregon. Assim que tiver feito isso, poderei criar meu modelo de lançamento. E, como podemos ver, meu modelo de inicialização foi criado com sucesso. E se eu acessar para Exibir modelos de inicialização, poderei ver o modelo de inicialização recém-criado. A partir daqui, preciso criar o grupo de Auto Scaling real. Para fazer isso, vou rolar para baixo no painel de navegação à esquerda. E, em Auto Scaling, vou selecionar Auto Scaling Groups. No momento, não tenho nenhum grupo de Auto Scaling, portanto, vou clicar em Create Auto Scaling group. O nome desse grupo será app-asg. E como criei um modelo de inicialização, posso ir em frente e selecionar o modelo de inicialização que foi criado especificamente para esse grupo. Depois de selecionado, posso ir em frente e clicar em Next. E é aqui que posso escolher várias opções de inicialização. Portanto, neste caso, quero ter certeza de que estou lançando no meu app-vpc, e, em seguida, quero lançar essas instâncias nas minhas sub-redes públicas. Portanto, escolherei Public Subnet 1 e Public Subnet 2. Com essas opções selecionadas, posso clicar em Next. E agora estou nas minhas opções avançadas. Isso é importante porque criei um balanceador de carga e preciso ter certeza de que esse grupo Auto Scaling está utilizando esse balanceador de carga. Portanto, o que posso fazer é anexar a um balanceador de carga existente, e, em seguida, escolher o balanceador de carga nos grupos de destino do balanceador de carga. A partir daqui, posso simplesmente soltar essa opção e selecionar app-target-group. E, em seguida, para as minhas verificações de saúde, farei com que o balanceador de carga cuide das verificações de saúde, uma vez que elas já foram configuradas. Depois disso, clicarei em Next. E é aqui que posso decidir quão grande e quão pequeno quero que meu grupo de instâncias ou minha frota de instâncias seja. Portanto, o que vou fazer aqui é: Vou alterar minha capacidade desejada para dois. Também quero que minha capacidade mínima seja dois, e depois quero que minha capacidade máxima seja quatro. Isso significa que meu grupo de Autoescala será iniciado com duas instâncias, e nunca ficará menor do que duas instâncias. Portanto, se uma dessas duas instâncias for considerada insalubre, será iniciada uma instância para substituí-la. Se houver uma carga no balanceador de carga e uma carga nas instâncias, então o máximo que minha frota, o tamanho máximo que minha frota terá é de quatro instâncias. E é isso que esse tamanho de grupo está estabelecendo. Depois disso, quero ter certeza de que, para minhas políticas de escalonamento, escolho uma política de escalonamento de destino. E para essa política de escalonamento de destino, posso alterar meu valor de destino para que a utilização média da CPU seja 60, e manterei os 300 segundos de aquecimento como padrão. Isso apenas garantirá que, se eu escalonar, o escalonamento será baseado na utilização média da CPU em toda a minha frota, e, se esse valor atingir ou ultrapassar 60%, , ele iniciará novas instâncias, mas dará a essas instâncias 300 segundos ou cinco minutos para se aquecerem e começarem a passar por suas verificações de integridade antes de realizar outra ação de escalonamento. Então, agora que isso foi feito, posso ir em frente e clicar em Next. E para as notificações, não vou adicionar notificações para o meu passo a passo, mas aqui o senhor poderia adicionar uma notificação e fazer dessa notificação um tópico SNS e utilizar seu endereço de e-mail para que possa ser notificado sempre que uma ação de dimensionamento for realizada. Mas, em vez disso, vou clicar em Next (Avançar), e, em seguida, em Next (Avançar) novamente, e verificar rapidamente se tudo está onde eu quero antes de criar meu grupo Auto Scaling. Agora que meu grupo Auto Scaling foi criado, preciso que ele leve tudo para a capacidade desejada. E, quando estiver lá, posso testar e me certificar de que meu aplicativo ainda está acessível, e, então, posso testar o dimensionamento. Portanto, antes de testar meu aplicativo, o que quero fazer é voltar ao Console do EC2, e, em seguida, em Balanceamento de carga, próximo à parte inferior do menu à esquerda, quero clicar em Grupos de destino. A razão pela qual estou fazendo isso é que, quero ter certeza de que antes de começar a testar qualquer coisa, que tudo está funcionando e está saudável. Se eu quiser ficar de olho nisso, o que posso fazer é clicar em Targets. E, como o senhor pode ver, o grupo Auto Scaling lançou duas instâncias adicionais, uma em cada Availability Zone, e elas estão saudáveis no momento. Isso significa que meu aplicativo está ativo e em execução e agora tenho várias instâncias que serão utilizadas sempre que forem feitas solicitações. E assim, se uma delas se tornar insalubre ou cair por qualquer motivo, tenho as outras instâncias para ainda atender a essas solicitações. Portanto, para testar meu aplicativo e o dimensionamento do aplicativo, o que vou fazer é voltar à página do aplicativo que tenho aberta, e há um teste de estresse incorporado a esse aplicativo apenas para facilitar esse exercício. Então, o que farei é acrescentar /info ao final do meu URL, e isso me levará à página que me permite lidar com algumas ferramentas. Uma das coisas que posso fazer é atualizar essa página e ela, como os senhores verão, irá percorrer as várias instâncias que tenho em execução e as Zonas de Disponibilidade em que essas instâncias estão em execução. Portanto, a atualização mostrará que está alterando as instâncias e as Zonas de Disponibilidade que estão sendo atingidas. Mas o que quero fazer para testar esse é utilizar esse teste de Stress cpu, embutido aqui. E vou em frente e estressar a CPU por 10 minutos. Isso vai me permitir estressar minha CPU para que ela ultrapasse o limite de 60% e inicie novas instâncias. Enquanto espero que isso aconteça, vou voltar para o grupo de alvos e visualizar meus alvos. Depois, vou atualizá-lo periodicamente para ver quando novas instâncias estão sendo adicionadas e quando estão saudáveis. Portanto, vou aguardar alguns minutos enquanto espero que elas sejam iniciadas. Agora que já dei um tempo, vou ver se algumas instâncias novas foram lançadas. Então, vou acessar Instances e, como posso ver, mais duas instâncias foram lançadas em resposta à ação de dimensionamento que está acontecendo por causa do estresse da CPU que iniciamos. Portanto, essas instâncias serão lançadas e, em seguida, serão adicionadas ao grupo de instâncias que fazem parte de toda a frota. Espero que os senhores tenham gostado do curso e que os exercícios tenham sido úteis. E nos vemos em outro curso.