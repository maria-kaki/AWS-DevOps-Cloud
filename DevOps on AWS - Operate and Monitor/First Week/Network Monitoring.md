![[index (6).mp4]]
It's time to talk about monitoring your network. Specifically, through logging. Logging often comes in handy when you want to gather information about requests that are coming into your system, and depending on the way your system is set up and the services you're using, you may have a few options on how to enable logging. Take a look at this architecture. Here, we have an Amazon Virtual Private Cloud, or VPC, with a few subnets. We have two EC2 instances, a load balancer to distribute traffic to those instances, and an internet gateway so that internet traffic can flow to the subnets with the appropriate routes dictating that it can do so, of course. If I wanted to enable logging for this architecture to get an idea of the type of requests getting sent through my network into my application, where could I do that? Turns out, I have a few options. The first is through VPC Flow Logs. These are meant as a way to capture information about IP traffic coming into our VPC, our subnets, and any network interface. You might not be familiar with the concept of network interfaces, but you can think of them as virtual network cards that maintain data like IP addresses, MAC addresses, and more. The important thing to know here is that EC2 instances, or resources that run on EC2 instances, such as load balancers and RDS databases, use these network interfaces. So for any of these resources, you can create flow logs.
# __
To create a flow log, I'll specify the resource I want it to collect information for, maybe a subnet or an EC2 instance, then I'll specify the kind of traffic I want to collect. If it was traffic that was accepted, traffic that was rejected, or all of the above.
# __
And then where do I want this traffic to be delivered to? For example, we can either send these logs to S3 or CloudWatch Logs.
# __
After I create it, it'll take a few minutes to start collecting traffic, but pretty soon I can get information like the number of packets and bytes that have been transferred between the start and end timestamp for the request. And I can even get enriched data, like the type of traffic. Was it IPv4, IPv6, is there TCP flags? All of that information will be sent to either S3 or CloudWatch Logs--again, your choice.
# __
So for this architecture, I can enable flow logs for my VPC, my subnets, my EC2 instances, and for my load balancer. For my load balancer, I can take it one step further and enable access logs, which allow me to collect information about requests sent to my load balancer.
# __
ELB access logs are disabled by default, but you can choose to enable them to get information about your requests. For example, I can get info, like client IP address, latencies, request paths, server responses, and more. Also, if the request gets to the load balancer, but never gets to a target such as an EC2 instance, the request still gets logged, so you can dive in and figure out if it was maybe a malformed request or if maybe there was no healthy EC2 instance to respond to it. Let's take a look at another architecture. This time, a serverless architecture. Here we have a CloudFront distribution, an API Gateway, a Lambda function and a DynamoDB table. No network in sight, no ELB in sight, so where can I enable logging here? The first opportunity is to enable logging with CloudFront. You can log every request that comes into your distribution. There are two ways of doing this. The first is that you can enable standard logs, also called access logs sometimes, and it will provide a detailed record of each request, batch those together, and deliver to Amazon S3. The second way of doing it is to enable real-time logs, which as the name implies, gives you a detailed record of a request and delivers that to you within seconds of getting the request. Now, you don't have to get a detailed record for every request if you don't want that. You can set up a percentage of requests to get records for, or even set up fields that requests have to match in order to be delivered a record of that request. Real-time records are delivered to Kinesis Data Streams.
# __
So that's one place. The next place I can enable logging is with API Gateway. There are also two ways of logging with API Gateway: Access logs and execution logs. With access logs, you can find out who has access to your API and how they accessed it. With execution logs, you can get information about errors, execution traces, information about payloads, and so on. Both of these create logs in CloudWatch Logs. So, those are opportunities for logs with this architecture. Now on to the real issue, which is once I have logging turned on for all these services, how do I get real insights from all of that data? Short answer is through data-analysis tools.
# __
If your logs are going to Amazon S3, you can use analytics services, like Amazon Athena and Amazon QuickSight, to query and visualize your log data, or even put it in an Elasticsearch cluster and use Kibana. On the other hand, if your logs are going to CloudWatch Logs, you can use CloudWatch Logs Insights to search and query your log data so that you can easily filter through your data and better troubleshoot any operational issues. All right, that's it for this one, and I will see you next time.