![[index (8).mp4]]
Imagine the following scenario: You have an EC2 instance and two subnets that you create via CloudFormation, subnet A and subnet B. After creating the stack, you realize that you forgot to add tags in the instance. And let's say you go in the AWS Management Console and add the tags. In this case, tagging strategy is very important because you are running a script that the security checks only on instances marked with specific tags, like environment = prod, which is the case here. One week later, you forgot that you manually added these tags and decide to change that CloudFormation template by doing a modification on the instance. You'll now want to change the instance subnets from subnet A to subnet B. According to the CloudFormation documentation, a subnet change requires a replacement of the resource. You should always pay attention to updates that require replacements because the current resource will be deleted, and a new one will be created. And guess what? If you forgot to include in the template the tags you manually added, they won't be present in the new resource, making your security checks not check that instance anymore.
# __
I like to say that CloudFormation is jealous, and you should not touch the resources it creates. Avoid at all costs manually changing your infrastructure once it was created by CloudFormation, because if you want to change something in the template, it may override what you have done manually.
# __
It may get easier when you are the only one modifying an infrastructure, because you are more likely to remember what you did, but it gets extremely challenging. If you have multiple DevOps people interacting with the environment. Although the best practice is never manually touching any environment created by CloudFormation, if you have people having permission to do so, trust me, they will. And this is what we call CloudFormation drift. Drifts happen when the environment gets changed and CloudFormation is not aware of the change. Drifts are not when you change the running code with existing resources. This is called a deployment. Drifts happen when manual infrastructure configuration changes are made, like tags, security groups, instance types. That's potentially dangerous for production environments because sometimes, someone may have done an undocumented action to apply a hotfix on a Friday night, which may be overridden by the next time you update the stack.
# __
To get a little help from CloudFormation, you can count on a feature called drift detection. In the described scenario, if I had changed the tags, running CloudFormation drift detection for the EC2 resource would point out to me that the current tags of the instance do not match the tags that CloudFormation was instructed to create. You should pay special attention to these drifts, especially if the change you want to do via CloudFormation requires a replacement of the resource, and especially if that resource contains data from your users.
# __
The easiest way to avoid drifts and be safer here, is not manually changing whatever was created via CloudFormation, and it should be a best practice to incorporate drift detection as part of your CI/CD build process, since everything here can and should be done, programmatically.
